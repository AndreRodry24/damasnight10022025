export const blacklist = [
    '556781366643@s.whatsapp.net', 
    '5519992350482@s.whatsapp.net',
    '5511970662569@s.whatsapp.net',
    '5511999680582@s.whatsapp.net',
    '5524999331275@s.whatsapp.net',
    '14259810678@s.whatsapp.net',
    '5521989812827@s.whatsapp.net',
    '5521975528535@s.whatsapp.net',
    '558798230371@s.whatsapp.net',  
    '558288549074@s.whatsapp.net', 
    '557184226391@s.whatsapp.net', 
    '5511940379455@s.whatsapp.net',
    '558294067179@s.whatsapp.net',
    '5511910950513@s.whatsapp.net',
    '5511978587121@s.whatsapp.net',
    '5511915724305@s.whatsapp.net',
    '554896299816@s.whatsapp.net',
    '559881450273@s.whatsapp.net',
    '5521984008513@s.whatsapp.net',
    '557184628906@s.whatsapp.net',
    '5511976068943@s.whatsapp.net',
    '553193363098@s.whatsapp.net',
    '553172519802@s.whatsapp.net',
    '559591202080@s.whatsapp.net',
    '5517996700879@s.whatsapp.net',
    '553498345875@s.whatsapp.net',
    '554588309282@s.whatsapp.net',
    '5511917887069@s.whatsapp.net',
    '5516993010201@s.whatsapp.net',
    '558199293728@s.whatsapp.net',
    '5513991064073@s.whatsapp.net',  
    '556999917233@s.whatsapp.net',
    '559187093578@s.whatsapp.net',
    '559884804299@s.whatsapp.net',
    '556295502297@s.whatsapp.net',
    '5514991368989@s.whatsapp.net',
    '558296427679@s.whatsapp.net',
    '5514996905350@s.whatsapp.net',
    '553398015777@s.whatsapp.net',
    '557188019202@s.whatsapp.net',
    '557193063322@s.whatsapp.net',
    '5512978120133@s.whatsapp.net',
    '5513996231574@s.whatsapp.net',
    '553185501047@s.whatsapp.net',
    '558487210066@s.whatsapp.net',
    '557981402379@s.whatsapp.net',
    '553398191293@s.whatsapp.net',
    '557188558894@s.whatsapp.net',
    '557981402379@s.whatsapp.net',
    '558899938997@s.whatsapp.net',
    '558897814418@s.whatsapp.net',
    '558893458792@s.whatsapp.net',
    '558893034659@s.whatsapp.net',
    '553291181821@s.whatsapp.net',
    '557399397474@s.whatsapp.net',
    '554199027131@s.whatsapp.net',
    '557999143297@s.whatsapp.net',
    '558791420122@s.whatsapp.net',
    '559982510090@s.whatsapp.net',
    '559584083516@s.whatsapp.net',
    '558389080968@s.whatsapp.net',
    '559981523735@s.whatsapp.net',
    '5511949411043@s.whatsapp.net',
    '557197048875@s.whatsapp.net',
    '5521995022376@s.whatsapp.net',
    '558281288083@s.whatsapp.net',
    '553492596180@s.whatsapp.net',
    '559883426182@s.whatsapp.net',
    '553192347569@s.whatsapp.net',
    '553187917527@s.whatsapp.net',
    '553391311272@s.whatsapp.net',
    '558598416501@s.whatsapp.net',
    '5516992249434@s.whatsapp.net',
    '5511969429735@s.whatsapp.net',
    '553597143032@s.whatsapp.net',
    '554699813850@s.whatsapp.net',
    '553197215611@s.whatsapp.net',
    '553284566375@s.whatsapp.net',
    '5521976122142@s.whatsapp.net',
    '5511933237222@s.whatsapp.net',
    '994400722871@s.whatsapp.net',
    '558291731004@s.whatsapp.net',
    '5511917230550@s.whatsapp.net',
    '5511970594020@s.whatsapp.net',
    '557391442762@s.whatsapp.net',
    '557199665077@s.whatsapp.net',
    '557182314620@s.whatsapp.net',
    '557187095766@s.whatsapp.net',
    '559499743453@s.whatsapp.net',
    '5511969011676@s.whatsapp.net',
    '14125936219@s.whatsapp.net',
    '553597570421@s.whatsapp.net',
    '5511944747914@s.whatsapp.net',
    '19029150723@s.whatsapp.net',
    '5522999024147@s.whatsapp.net',
    '557399506672@s.whatsapp.net',
    '5521980016447@s.whatsapp.net',
    '553497296595@s.whatsapp.net',
    '557591256412@s.whatsapp.net',
    '554197513404@s.whatsapp.net',
    '5511946728530@s.whatsapp.net',
    '5521993714758@s.whatsapp.net',
    '558888539936@s.whatsapp.net',
    '556182642671@s.whatsapp.net',
    '556281930958@s.whatsapp.net',
    '559492374774@s.whatsapp.net',
    '557391362266@s.whatsapp.net',
    '5513997558257@s.whatsapp.net',
    '552299024147@s.whatsapp.net',
    '557391470251@s.whatsapp.net',
    '558581447011@s.whatsapp.net',
    '51595975191@s.whatsapp.net',
    '559981670563@s.whatsapp.net',
    '553398015777@s.whatsapp.net',
    '5517997858075@s.whatsapp.net',
    '5521997571396@s.whatsapp.net',
    '559988338555@s.whatsapp.net',
    '19712319850@s.whatsapp.net',
    '556699525015@s.whatsapp.net',
    '553498345875@s.whatsapp.net',
    '557193225533@s.whatsapp.net',
    '5511974552469@s.whatsapp.net',
    '557199086321@s.whatsapp.net',
    '5521967621577@s.whatsapp.net',
    '5511937534196@s.whatsapp.net',
    '556699826173@s.whatsapp.net',
    '556681104416@s.whatsapp.net',
    '556999029068@s.whatsapp.net',
    '553898891065@s.whatsapp.net',
    '5511949460464@s.whatsapp.net',
    '553192347569@s.whatsapp.net',
    '5519989959719@s.whatsapp.net',
    '554999105859@s.whatsapp.net',
    '554588309282@s.whatsapp.net',
    '5524999148015@s.whatsapp.net',
    '558894158969@s.whatsapp.net',
    '559189824445@s.whatsapp.net',
    '553193363098@s.whatsapp.net',
    '558496306099@s.whatsapp.net',
    '553191047232@s.whatsapp.net',
    '5511919658784@s.whatsapp.net',
    '553491323451@s.whatsapp.net',
    '5521972079587@s.whatsapp.net',
    '556681037218@s.whatsapp.net',
    '556194427269@s.whatsapp.net',
    '5514991924302@s.whatsapp.net',
    '553598341564@s.whatsapp.net',
    '5514996905350@s.whatsapp.net',
    '5528999657954@s.whatsapp.net',
    '557399768004@s.whatsapp.net',
    '554591286273@s.whatsapp.net',
    '556599980428@s.whatsapp.net',
    '5521995267006@s.whatsapp.net',
    '556984845737@s.whatsapp.net',
    '556198197569@s.whatsapp.net',
    '558894114075@s.whatsapp.net',
    '5517935001962@s.whatsapp.net',
    '554891482370@s.whatsapp.net',
    '554699813850@s.whatsapp.net',
    '5521987297347@s.whatsapp.net',
    '5511974700583@s.whatsapp.net',
    '5513996704053@s.whatsapp.net',
    '559191440014@s.whatsapp.net',
    '556699525015@s.whatsapp.net',
    '5527997159326@s.whatsapp.net',
    '557391194217@s.whatsapp.net',
    '19085203530@s.whatsapp.net',
    '553884286132@s.whatsapp.net',
    '5511959561327@s.whatsapp.net',
    '556199048824@s.whatsapp.net',
    '554598252736@s.whatsapp.net',
    '557391442762@s.whatsapp.net',
    '5521972014469@s.whatsapp.net',
    '17472082670@s.whatsapp.net',
    '5521975447107@s.whatsapp.net',
    '552798724796@s.whatsapp.net',
    '554891148239@s.whatsapp.net',
    '558698183810@s.whatsapp.net',
    '558994537461@s.whatsapp.net',
    '5511963567061@s.whatsapp.net',
    '557391123933@s.whatsapp.net',
    '553190855799@s.whatsapp.net',
    '557999965965@s.whatsapp.net',
    '5521979065069@s.whatsapp.net',
    '559181894246@s.whatsapp.net',
    '5521993323312@s.whatsapp.net',
    '557182560370@s.whatsapp.net',
    '559791535871@s.whatsapp.net',
    '5511912563105@s.whatsapp.net',
    '5521989144500@s.whatsapp.net',
    '558893034659@s.whatsapp.net',
    '558589870925@s.whatsapp.net',
    '558896431564@s.whatsapp.net',
    '558899938997@s.whatsapp.net',
    '553198489151@s.whatsapp.net',
    '556781467999@s.whatsapp.net',
    '554588363510@s.whatsapp.net',
    '557391123933@s.whatsapp.net',
    '557391442762@s.whatsapp.net',
    '557391194217@s.whatsapp.net',
    '555391886136@s.whatsapp.net',
    '554891634904@s.whatsapp.net',
    '59173014147@s.whatsapp.net',
    '558291255223@s.whatsapp.net',
    '553196437224@s.whatsapp.net',
    '5511919677479@s.whatsapp.net',
    '5522920090551@s.whatsapp.net',
    '554891393173@s.whatsapp.net',
    '553193363098@s.whatsapp.net',
    '5522999236037@s.whatsapp.net',
    '5514991368989@s.whatsapp.net',
    '554298298257@s.whatsapp.net',
    '5515996654434@s.whatsapp.net',
    '559991525856@s.whatsapp.net',
    '5521987923441@s.whatsapp.net',
    '557588183451@s.whatsapp.net',
    '447873140044@s.whatsapp.net',
    '5511983943439@s.whatsapp.net',
    '554891634904@s.whatsapp.net',
    '555199604913@s.whatsapp.net',
    '5511962642347@s.whatsapp.net',
    '558896272640@s.whatsapp.net',
    '559884156462@s.whatsapp.net',
    '5524999144957@s.whatsapp.net',
    '5521972109576@s.whatsapp.net',
    '5527992567234@s.whatsapp.net',
    '557197125577@s.whatsapp.net',
    '559691946972@s.whatsapp.net',
    '557391099556@s.whatsapp.net',
    '557391099801@s.whatsapp.net',
    '557999592230@s.whatsapp.net',
    '556484448232@s.whatsapp.net'
];

const BATCH_SIZE = 500; // Tamanho de cada lote para processamento da blacklist

// Função para dividir a blacklist em lotes
function splitBlacklist(blacklist, batchSize) {
    const batches = [];
    for (let i = 0; i < blacklist.length; i += batchSize) {
        batches.push(blacklist.slice(i, i + batchSize));
    }
    return batches;
}

// Função que verifica se o usuário está na blacklist em lotes
async function checkBlacklistInBatches(sock, groupId, participants) {
    const batches = splitBlacklist(blacklist, BATCH_SIZE);

    for (const batch of batches) {
        for (const participant of participants) {
            const usuarioId = participant.id;

            // Verifica se o usuário está na blacklist
            if (batch.includes(usuarioId)) {
                console.log(`Usuário ${usuarioId} está na blacklist. Removendo do grupo.`);

                // Remove o usuário do grupo
                await banUser(sock, groupId, usuarioId);

                // Notifica o grupo
                await notifyUserRemoved(sock, groupId, usuarioId);
            }
        }
    }
}

export async function handleGroupParticipants(sock, groupId) {
    try {
        // Obtém os participantes do grupo
        const groupMetadata = await sock.groupMetadata(groupId);
        const participants = groupMetadata.participants;

        console.log(`Verificando participantes do grupo ${groupId}...`);

        // Verifica os participantes em lotes
        await checkBlacklistInBatches(sock, groupId, participants);
    } catch (err) {
        console.error(`Erro ao verificar participantes do grupo ${groupId}:`, err);
    }
}

export async function handleMessage(sock, message) {
    console.log("Mensagem recebida:", message);

    const textoMensagem = message.message?.conversation || message.message?.imageMessage?.caption;

    if (textoMensagem) {
        const grupoId = message.key.remoteJid;
        const usuarioId = message.key.participant || message.key.remoteJid;

        // Verifica se o usuário está na blacklist
        if (blacklist.includes(usuarioId)) {
            console.log(`Usuário ${usuarioId} está na blacklist. Ignorando e removendo mensagem.`);

            // Apaga a mensagem do grupo
            await sock.sendMessage(grupoId, { delete: message.key });

            // Remove o usuário do grupo
            await banUser(sock, grupoId, usuarioId);

            // Notifica o grupo
            await notifyUserRemoved(sock, grupoId, usuarioId);
        }
    }
}

export async function banUser(sock, groupId, userId) {
    try {
        await sock.groupParticipantsUpdate(groupId, [userId], 'remove');
        console.log(`Usuário ${userId} removido do grupo ${groupId}`);
    } catch (err) {
        console.error(`Erro ao remover usuário ${userId} do grupo ${groupId}:`, err);
    }
}

export async function notifyUserRemoved(sock, groupId, userId) {
    try {
        const userMention = `@${userId.split('@')[0]}`;
        await sock.sendMessage(groupId, { 
            text: `*Usuário(a):* ${userMention} foi *BANIDO(a)* do grupo 👏🍻 *DﾑMﾑS* 💃🔥 *Dﾑ* *NIGӇԵ*💃🎶🍾🍸 \n \n *Motivo:* Está na lista negra! 🚷🚫`,
            mentions: [userId]
        });
        console.log(`Notificação enviada ao grupo ${groupId} para usuário ${userId}.`);
    } catch (err) {
        console.error(`Erro ao enviar notificação ao grupo ${groupId}:`, err);
    }
}

// Exemplo de uso: Verificar participantes ao entrar no grupo
export async function onGroupJoin(sock, groupId) {
    console.log(`Bot entrou no grupo ${groupId}. Iniciando verificação.`);
    await handleGroupParticipants(sock, groupId);
}
